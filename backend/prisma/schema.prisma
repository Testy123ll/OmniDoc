// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String       @id @default(cuid())
  email        String       @unique
  password     String
  name         String
  plan         Plan         @default(free)
  storageUsed  Float        @default(0)
  storageLimit Float        @default(1073741824) // 1GB
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  files        File[]
  aiPrompts    AIPrompt[]
  conversions  Conversion[]
}

model File {
  id           String       @id @default(cuid())
  userId       String
  originalName String
  storageName  String       @unique
  mimeType     String
  size         Int
  format       String
  url          String
  publicUrl    String?
  uploadedAt   DateTime     @default(now())
  expiresAt    DateTime?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  sourceConversions Conversion[] @relation("SourceFile")
  resultConversions Conversion[] @relation("ResultFile")
}

model AIPrompt {
  id        String     @id @default(cuid())
  userId    String
  type      PromptType
  input     String     @db.Text
  output    String     @db.Text
  language  String?
  tone      Tone?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Conversion {
  id            String           @id @default(cuid())
  userId        String
  sourceFileId  String
  targetFormat  String
  status        ConversionStatus @default(pending)
  resultFileId  String?
  error         String?
  completedAt   DateTime?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  user          User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  sourceFile    File             @relation("SourceFile", fields: [sourceFileId], references: [id], onDelete: Cascade)
  resultFile    File?            @relation("ResultFile", fields: [resultFileId], references: [id], onDelete: SetNull)

  @@index([sourceFileId])
  @@index([resultFileId])
}

enum Plan {
  free
  pro
  business
}

enum PromptType {
  write
  edit
  summarize
  translate
  analyze
}

enum Tone {
  formal
  casual
  academic
  friendly
}

enum ConversionStatus {
  pending
  processing
  completed
  failed
}
